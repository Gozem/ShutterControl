<!doctype html> 
<html>
<head>
<title>Websocket</title>
</head>
<body>
<h1>Websocket</h1>
<label id="conn_text"></label><br />
<label id="temp_1"></label><br />
<label id="temp_2"></label><br />
<label id="shutterStatus"></label><br />

<div>
  <button type="button" onclick="button('UP');"  >Up  </button><br/>
  <button type="button" onclick="button('STOP');">Stop</button><br/>
  <button type="button" onclick="button('DOWN');">Down</button><br/>
  <br/>
  <button type="button" onclick="button('FORCEUP');"  >ForceUp  </button><br/>
  <button type="button" onclick="button('FORCEDOWN');">ForceDown</button><br/>
</div>
<div id="messages_txt" />
<script>
    var ws = null;
    var conn_status = document.getElementById('conn_text');

    function start() {
      var loc = window.location;
      var uri = "ws://" + loc.host + "/ws";
      console.log("Connecting...");
      console.log(uri);
      conn_status.innerHTML = "Connection status: Connecting..."
      ws = new WebSocket(uri);

      ws.onopen = function(evt) {
        conn_status.innerHTML = "Connection status: Connected!"
      }

      ws.onmessage = function(evt) {
        console.log(evt.data)

        var newMessage = document.createElement('p');
        newMessage.textContent = "Server: " + evt.data;
        document.getElementById('messages_txt').appendChild(newMessage);

        //var label_temp1 = document.getElementById('temp_1');
        //var label_temp2 = document.getElementById('temp_2');
        //current_temp = (evt.data).split(";");			
        //label_temp1.innerHTML = "Temp1: " + current_temp[0];                        
        //label_temp2.innerHTML = "Temp2: " + current_temp[1];

        var label_shutterStatus = document.getElementById('shutterStatus');
        label_shutterStatus.innerHTML = "Status: " + evt.data
      };

      ws.onclose = function(event) {
        conn_status.innerHTML = "Connection status: Disconnected!"      
        check(); //Reconnect now
      };

      ws.onerror = function(error) {
        conn_status.innerHTML = "Connection status: Error: " + error;
        console.log("ERROR: " + error);
      }

  }

  function check() {
    if (!ws || ws.readyState == 3) start();
  }

    function button(cmd) {
      console.log("Button cmd: " + cmd);
      ws.send(cmd);
    }

  start();
  setInterval(check, 3000);

</script>
</body></html>
